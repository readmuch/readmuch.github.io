<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Readmuch's Blog - Exploring the intersection of knowledge and creativity">
    <meta name="keywords" content="Book, Education, Technology, Life, Mindnotes">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="color-scheme" content="dark">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Readmuch's Blog">
    <meta property="og:description" content="Exploring the intersection of knowledge and creativity">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://readmuch.github.io">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Readmuch's Blog">
    <meta name="twitter:description" content="Exploring the intersection of knowledge and creativity">
    
    <title>Readmuch's Blog</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!-- Preload critical assets -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="images/book.jpg" as="image">
    <link rel="preload" href="images/education.jpg" as="image">
    <link rel="preload" href="images/life.jpg" as="image">
    <link rel="preload" href="images/tech.jpg" as="image">
    <link rel="preload" href="images/mindnotes.jpg" as="image">
    
    <!-- Font loading -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <header>
        <h1>Readmuch's Blog</h1>
        <p>Exploring the intersection of knowledge and creativity</p>
    </header>
    <main class="container" role="main" aria-label="Blog Categories">
        <article class="card">
            <a href="book.html" aria-label="Book Category">
                <img src="images/book.jpg" alt="Book Category - A collection of book reviews and literary discussions" loading="lazy" width="300" height="220" decoding="async">
                <span>Book</span>
            </a>
        </article>
        <article class="card">
            <a href="education.html" aria-label="Education Category">
                <img src="images/education.jpg" alt="Education Category - Insights and resources about learning and teaching" loading="lazy" width="300" height="220" decoding="async">
                <span>Education</span>
            </a>
        </article>
        <article class="card">
            <a href="life.html" aria-label="Lifestyle Category">
                <img src="images/life.jpg" alt="Lifestyle Category - Personal experiences and life lessons" loading="lazy" width="300" height="220" decoding="async">
                <span>Lifestyle</span>
            </a>
        </article>
        <article class="card">
            <a href="tech.html" aria-label="Technology Category">
                <img src="images/tech.jpg" alt="Technology Category - Technology trends and innovations" loading="lazy" width="300" height="220" decoding="async">
                <span>Technology</span>
            </a>
        </article>
        <article class="card">
            <a href="mindnotes.html" aria-label="Mind Notes Category">
                <img src="images/mindnotes.jpg" alt="Mind Notes Category - Thoughts and reflections on various topics" loading="lazy" width="300" height="220" decoding="async">
                <span>Mind Notes</span>
            </a>
        </article>
    </main>
    
    <!-- Visitor counter display (temporarily disabled) -->
    <!--
    <div style="text-align: center; margin: 2em 0; font-size: 0.9em; color: #888;">
        <span id="visitor-count">ë°©ë¬¸ì ìˆ˜: ë¡œë”© ì¤‘...</span>
        <br>
        <button id="refresh-visitor-count" style="margin-top: 0.5rem; padding: 0.3rem 0.8rem; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; display: none;">
            ìƒˆë¡œê³ ì¹¨
        </button>
    </div>
    -->
    
    <!-- Temporary message -->
    <div style="text-align: center; margin: 2em 0; font-size: 0.9em; color: #888;">
        <span>ë°©ë¬¸ì ì¹´ìš´í„° ì„¤ì • ì¤‘...</span>
        <br>
        <small style="color: #666;">GoatCounter ê³„ì • ì„¤ì • í›„ í™œì„±í™”ë©ë‹ˆë‹¤</small>
    </div>
    
    <footer>
        <p>&copy; 2024 Readmuch's Blog. All rights reserved.</p>
    </footer>
    
    <!-- GoatCounter tracking code -->
    <script data-goatcounter="https://readmuch.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    
    <!-- Enhanced visitor count with fallback -->
    <script>
        // Load configuration and analytics modules
        let analytics = null;
        
        // Test function to diagnose issues
        async function testGoatCounter() {
            console.log('ğŸ” Testing GoatCounter connection...');
            
            try {
                const testUrl = 'https://readmuch.goatcounter.com/counter/export.json';
                console.log('ğŸ“¡ Testing URL:', testUrl);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    signal: AbortSignal.timeout(10000)
                });
                
                console.log('ğŸ“Š Response status:', response.status);
                console.log('ğŸ“Š Response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… Success! Data received:', data);
                    return true;
                } else {
                    console.error('âŒ HTTP Error:', response.status, response.statusText);
                    return false;
                }
            } catch (error) {
                console.error('âŒ Fetch Error:', error);
                console.error('âŒ Error type:', error.name);
                console.error('âŒ Error message:', error.message);
                return false;
            }
        }
        
        async function initAnalytics() {
            console.log('ğŸš€ Initializing analytics...');
            
            // First, test GoatCounter connection
            const goatCounterWorks = await testGoatCounter();
            
            if (!goatCounterWorks) {
                console.warn('âš ï¸ GoatCounter test failed, using fallback...');
                updateVisitorCountDirect();
                return;
            }
            
            try {
                // Try to load the config module
                if (typeof SiteConfig !== 'undefined') {
                    console.log('âœ… SiteConfig module found');
                    const config = new SiteConfig();
                    await config.load();
                    
                    if (typeof Analytics !== 'undefined') {
                        console.log('âœ… Analytics module found');
                        analytics = new Analytics(config);
                        analytics.init();
                    } else {
                        console.warn('âš ï¸ Analytics module not found, using direct fetch');
                        updateVisitorCountDirect();
                    }
                } else {
                    console.warn('âš ï¸ SiteConfig module not found, using direct fetch');
                    updateVisitorCountDirect();
                }
            } catch (error) {
                console.error('âŒ Failed to initialize analytics:', error);
                updateVisitorCountDirect();
            }
        }
        
        async function updateVisitorCountDirect() {
            const visitorCountElement = document.getElementById('visitor-count');
            const refreshButton = document.getElementById('refresh-visitor-count');
            
            if (!visitorCountElement) {
                console.error('âŒ Visitor count element not found');
                return;
            }
            
            try {
                console.log('ğŸ”„ Attempting to fetch visitor count...');
                
                // Try GoatCounter first
                const response = await fetch('https://readmuch.goatcounter.com/counter/export.json', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    signal: AbortSignal.timeout(10000)
                });
                
                console.log('ğŸ“Š GoatCounter response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“Š GoatCounter data:', data);
                    
                    if (data && typeof data.total === 'number') {
                        visitorCountElement.textContent = `ë°©ë¬¸ì ìˆ˜: ${data.total.toLocaleString()}`;
                        refreshButton.style.display = 'none';
                        console.log('âœ… Visitor count updated successfully');
                        return;
                    } else {
                        console.warn('âš ï¸ Invalid data format from GoatCounter');
                    }
                } else {
                    console.warn('âš ï¸ GoatCounter returned error status:', response.status);
                }
                
                // If GoatCounter fails, try alternative counter
                console.log('ğŸ”„ Trying alternative counter...');
                await tryAlternativeCounter(visitorCountElement);
                
            } catch (error) {
                console.error('âŒ Visitor count fetch failed:', error);
                console.error('âŒ Error details:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
                
                // Show specific error message
                let message = 'ë°©ë¬¸ì ìˆ˜: í™•ì¸ ë¶ˆê°€';
                if (error.name === 'AbortError') {
                    message = 'ë°©ë¬¸ì ìˆ˜: ì‹œê°„ ì´ˆê³¼';
                } else if (error.message.includes('404')) {
                    message = 'ë°©ë¬¸ì ìˆ˜: GoatCounter ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ';
                } else if (error.message.includes('CORS')) {
                    message = 'ë°©ë¬¸ì ìˆ˜: ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” í™•ì¸ ë¶ˆê°€';
                } else if (error.message.includes('Failed to fetch')) {
                    message = 'ë°©ë¬¸ì ìˆ˜: ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨';
                }
                
                visitorCountElement.textContent = message;
                refreshButton.style.display = 'inline-block';
            }
        }
        
        async function tryAlternativeCounter(element) {
            try {
                console.log('ğŸ”„ Trying countapi.xyz...');
                
                // Try countapi.xyz as fallback
                const response = await fetch('https://api.countapi.xyz/hit/readmuch.github.io/visits', {
                    signal: AbortSignal.timeout(5000)
                });
                
                console.log('ğŸ“Š countapi.xyz response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“Š countapi.xyz data:', data);
                    
                    if (data && typeof data.value === 'number') {
                        element.textContent = `ë°©ë¬¸ì ìˆ˜: ${data.value.toLocaleString()} (ëŒ€ì²´ ì¹´ìš´í„°)`;
                        console.log('âœ… Alternative counter worked');
                        return;
                    }
                }
                
                console.warn('âš ï¸ Alternative counter also failed');
                element.textContent = 'ë°©ë¬¸ì ìˆ˜: í™•ì¸ ë¶ˆê°€ (GoatCounter ê³„ì • ì„¤ì • í•„ìš”)';
                
            } catch (error) {
                console.error('âŒ Alternative counter failed:', error);
                element.textContent = 'ë°©ë¬¸ì ìˆ˜: í™•ì¸ ë¶ˆê°€ (ëª¨ë“  ì¹´ìš´í„° ì‹¤íŒ¨)';
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ Page loaded, starting analytics...');
            initAnalytics();
            
            // Manual refresh button
            const refreshButton = document.getElementById('refresh-visitor-count');
            if (refreshButton) {
                refreshButton.addEventListener('click', function() {
                    console.log('ğŸ”„ Manual refresh clicked');
                    if (analytics) {
                        analytics.refresh();
                    } else {
                        updateVisitorCountDirect();
                    }
                });
            }
        });
    </script>
</body>
</html>
