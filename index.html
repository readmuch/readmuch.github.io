<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Readmuch's Blog - Exploring the intersection of knowledge and creativity">
    <meta name="keywords" content="Book, Education, Technology, Life, Mindnotes">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="color-scheme" content="dark">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Readmuch's Blog">
    <meta property="og:description" content="Exploring the intersection of knowledge and creativity">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://readmuch.github.io">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Readmuch's Blog">
    <meta name="twitter:description" content="Exploring the intersection of knowledge and creativity">
    
    <title>Readmuch's Blog</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!-- Preload critical assets -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="images/book.jpg" as="image">
    <link rel="preload" href="images/education.jpg" as="image">
    <link rel="preload" href="images/life.jpg" as="image">
    <link rel="preload" href="images/tech.jpg" as="image">
    <link rel="preload" href="images/mindnotes.jpg" as="image">
    
    <!-- Font loading -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <header>
        <h1>Readmuch's Blog</h1>
        <p>Exploring the intersection of knowledge and creativity</p>
    </header>
    <main class="container" role="main" aria-label="Blog Categories">
        <article class="card">
            <a href="book.html" aria-label="Book Category">
                <img src="images/book.jpg" alt="Book Category - A collection of book reviews and literary discussions" loading="lazy" width="300" height="220" decoding="async">
                <span>Book</span>
            </a>
        </article>
        <article class="card">
            <a href="education.html" aria-label="Education Category">
                <img src="images/education.jpg" alt="Education Category - Insights and resources about learning and teaching" loading="lazy" width="300" height="220" decoding="async">
                <span>Education</span>
            </a>
        </article>
        <article class="card">
            <a href="life.html" aria-label="Lifestyle Category">
                <img src="images/life.jpg" alt="Lifestyle Category - Personal experiences and life lessons" loading="lazy" width="300" height="220" decoding="async">
                <span>Lifestyle</span>
            </a>
        </article>
        <article class="card">
            <a href="tech.html" aria-label="Technology Category">
                <img src="images/tech.jpg" alt="Technology Category - Technology trends and innovations" loading="lazy" width="300" height="220" decoding="async">
                <span>Technology</span>
            </a>
        </article>
        <article class="card">
            <a href="mindnotes.html" aria-label="Mind Notes Category">
                <img src="images/mindnotes.jpg" alt="Mind Notes Category - Thoughts and reflections on various topics" loading="lazy" width="300" height="220" decoding="async">
                <span>Mind Notes</span>
            </a>
        </article>
    </main>
    
    <!-- Visitor counter display (temporarily disabled) -->
    <!--
    <div style="text-align: center; margin: 2em 0; font-size: 0.9em; color: #888;">
        <span id="visitor-count">Î∞©Î¨∏Ïûê Ïàò: Î°úÎî© Ï§ë...</span>
        <br>
        <button id="refresh-visitor-count" style="margin-top: 0.5rem; padding: 0.3rem 0.8rem; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; display: none;">
            ÏÉàÎ°úÍ≥†Ïπ®
        </button>
    </div>
    -->
    
    <!-- Temporary message -->
    <div style="text-align: center; margin: 2em 0; font-size: 0.9em; color: #888;">
        <span>Î∞©Î¨∏Ïûê Ïπ¥Ïö¥ÌÑ∞ ÏÑ§Ï†ï Ï§ë...</span>
        <br>
        <small style="color: #666;">GoatCounter Í≥ÑÏ†ï ÏÑ§Ï†ï ÌõÑ ÌôúÏÑ±ÌôîÎê©ÎãàÎã§</small>
    </div>
    
    <footer>
        <p>&copy; 2024 Readmuch's Blog. All rights reserved.</p>
    </footer>
    
    <!-- GoatCounter tracking code -->
    <script data-goatcounter="https://readmuch.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    
    <!-- Enhanced visitor count with fallback -->
    <script>
        // Load configuration and analytics modules
        let analytics = null;
        
        // Test function to diagnose issues
        async function testGoatCounter() {
            console.log('üîç Testing GoatCounter connection...');
            
            try {
                const testUrl = 'https://readmuch.goatcounter.com/counter/export.json';
                console.log('üì° Testing URL:', testUrl);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    signal: AbortSignal.timeout(10000)
                });
                
                console.log('üìä Response status:', response.status);
                console.log('üìä Response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Success! Data received:', data);
                    return true;
                } else {
                    console.error('‚ùå HTTP Error:', response.status, response.statusText);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Fetch Error:', error);
                console.error('‚ùå Error type:', error.name);
                console.error('‚ùå Error message:', error.message);
                return false;
            }
        }
        
        async function initAnalytics() {
            console.log('üöÄ Initializing analytics...');
            
            // First, test GoatCounter connection
            const goatCounterWorks = await testGoatCounter();
            
            if (!goatCounterWorks) {
                console.warn('‚ö†Ô∏è GoatCounter test failed, using fallback...');
                updateVisitorCountDirect();
                return;
            }
            
            try {
                // Try to load the config module
                if (typeof SiteConfig !== 'undefined') {
                    console.log('‚úÖ SiteConfig module found');
                    const config = new SiteConfig();
                    await config.load();
                    
                    if (typeof Analytics !== 'undefined') {
                        console.log('‚úÖ Analytics module found');
                        analytics = new Analytics(config);
                        analytics.init();
                    } else {
                        console.warn('‚ö†Ô∏è Analytics module not found, using direct fetch');
                        updateVisitorCountDirect();
                    }
                } else {
                    console.warn('‚ö†Ô∏è SiteConfig module not found, using direct fetch');
                    updateVisitorCountDirect();
                }
            } catch (error) {
                console.error('‚ùå Failed to initialize analytics:', error);
                updateVisitorCountDirect();
            }
        }
        
        async function updateVisitorCountDirect() {
            const visitorCountElement = document.getElementById('visitor-count');
            const refreshButton = document.getElementById('refresh-visitor-count');
            
            if (!visitorCountElement) {
                console.error('‚ùå Visitor count element not found');
                return;
            }
            
            try {
                console.log('üîÑ Attempting to fetch visitor count...');
                
                // Try GoatCounter first
                const response = await fetch('https://readmuch.goatcounter.com/counter/export.json', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    signal: AbortSignal.timeout(10000)
                });
                
                console.log('üìä GoatCounter response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä GoatCounter data:', data);
                    
                    if (data && typeof data.total === 'number') {
                        visitorCountElement.textContent = `Î∞©Î¨∏Ïûê Ïàò: ${data.total.toLocaleString()}`;
                        refreshButton.style.display = 'none';
                        console.log('‚úÖ Visitor count updated successfully');
                        return;
                    } else {
                        console.warn('‚ö†Ô∏è Invalid data format from GoatCounter');
                    }
                } else {
                    console.warn('‚ö†Ô∏è GoatCounter returned error status:', response.status);
                }
                
                // If GoatCounter fails, try alternative counter
                console.log('üîÑ Trying alternative counter...');
                await tryAlternativeCounter(visitorCountElement);
                
            } catch (error) {
                console.error('‚ùå Visitor count fetch failed:', error);
                console.error('‚ùå Error details:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
                
                // Show specific error message
                let message = 'Î∞©Î¨∏Ïûê Ïàò: ÌôïÏù∏ Î∂àÍ∞Ä';
                if (error.name === 'AbortError') {
                    message = 'Î∞©Î¨∏Ïûê Ïàò: ÏãúÍ∞Ñ Ï¥àÍ≥º';
                } else if (error.message.includes('404')) {
                    message = 'Î∞©Î¨∏Ïûê Ïàò: GoatCounter Í≥ÑÏ†ïÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå';
                } else if (error.message.includes('CORS')) {
                    message = 'Î∞©Î¨∏Ïûê Ïàò: Î°úÏª¨ ÌôòÍ≤ΩÏóêÏÑúÎäî ÌôïÏù∏ Î∂àÍ∞Ä';
                } else if (error.message.includes('Failed to fetch')) {
                    message = 'Î∞©Î¨∏Ïûê Ïàò: ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ Ïã§Ìå®';
                }
                
                visitorCountElement.textContent = message;
                refreshButton.style.display = 'inline-block';
            }
        }
        
        async function tryAlternativeCounter(element) {
            try {
                console.log('üîÑ Trying countapi.xyz...');
                
                // Try countapi.xyz as fallback
                const response = await fetch('https://api.countapi.xyz/hit/readmuch.github.io/visits', {
                    signal: AbortSignal.timeout(5000)
                });
                
                console.log('üìä countapi.xyz response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä countapi.xyz data:', data);
                    
                    if (data && typeof data.value === 'number') {
                        element.textContent = `Î∞©Î¨∏Ïûê Ïàò: ${data.value.toLocaleString()} (ÎåÄÏ≤¥ Ïπ¥Ïö¥ÌÑ∞)`;
                        console.log('‚úÖ Alternative counter worked');
                        return;
                    }
                }
                
                console.warn('‚ö†Ô∏è Alternative counter also failed');
                element.textContent = 'Î∞©Î¨∏Ïûê Ïàò: ÌôïÏù∏ Î∂àÍ∞Ä (GoatCounter Í≥ÑÏ†ï ÏÑ§Ï†ï ÌïÑÏöî)';
                
            } catch (error) {
                console.error('‚ùå Alternative counter failed:', error);
                element.textContent = 'Î∞©Î¨∏Ïûê Ïàò: ÌôïÏù∏ Î∂àÍ∞Ä (Î™®Îì† Ïπ¥Ïö¥ÌÑ∞ Ïã§Ìå®)';
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Page loaded, starting analytics...');
            initAnalytics();
            
            // Manual refresh button
            const refreshButton = document.getElementById('refresh-visitor-count');
            if (refreshButton) {
                refreshButton.addEventListener('click', function() {
                    console.log('üîÑ Manual refresh clicked');
                    if (analytics) {
                        analytics.refresh();
                    } else {
                        updateVisitorCountDirect();
                    }
                });
            }
        });
    </script>
</body>
</html>
